/// See https://bheisler.github.io/criterion.rs/book/getting_started.html to add more benchmarks.
#[macro_use]
extern crate criterion;

use criterion::Criterion;
use accumulator::internal::group::{ElemFrom, Group, Rsa2048};
use rug::Integer;
use std::str::FromStr;

fn bench_op<G: Group + ElemFrom<Integer>>() {
  G::op(
    &G::elem(
      Integer::from_str(
        "111066521363124532171649626395987136074128970245601106158251038731392583290069",
      )
      .unwrap(),
    ),
    &G::elem(
      Integer::from_str(
        "106610920435831899020588753249099054915951032185883121197718271189872278955399",
      )
      .unwrap(),
    ),
  );
}

fn bench_op_large<G: Group + ElemFrom<Integer>>() {
  G::op(
    &G::elem(Integer::from_str(
      "21720738995539542858936915878186921869751915989840152165899303861582487240810878492659751749\
      672737203717627738047648700009977053044057502917091973287111671693426065546612150833232954361\
      536709981055037121764270784874720971933716065574032615073613728454497477072129686538873330572\
      773963696018637078230885896090312654536801520372853122471254294946328305929844982319416384204\
      134056551840145916685870951507887895129356414704422748714217113880489703934147612551938082501\
      753055296801829703017260731439871110215618988509545129088484396848644805730347466581515692959\
      313583208325725034506693916571047785061884094866050395109710",
    )
    .unwrap()),
    &G::elem(Integer::from_str(
      "31720738995539542858936915878186921869751915989840152165899303861582487240810878492659751749\
      672737203717627738047648700009977053044057502917091973287111671693426065546612150833232954361\
      536709981055037121764270784874720971933716065574032615073613728454497477072129686538873330572\
      773963696018637078230885896090312654536801520372853122471254294946328305929844982319416384204\
      134056551840145916685870951507887895129356414704422748714217113880489703934147612551938082501\
      753055296801829703017260731439871110215618988509545129088484396848644805730347466581515692959\
      313583208325725034506693916571047785061884094866050395109710",
    )
    .unwrap()),
  );
}

fn bench_exp<G: Group + ElemFrom<u8>>() {
  G::exp(
    &G::elem(2),
    &Integer::from_str(
      "65315136833896061809557254466951240071191890612435768575001173256020447546800029221544380288\
      474666886816442984548106882909827295319824031764930714696522619672276938781971873901815262421\
      654562691730669161126673833543570922556193096897121287444423696122691826661878849856991509472\
      508677693535083051665283493383",
    )
    .unwrap(),
  );
}

fn bench_inv<G: Group + ElemFrom<u8>>() {
  G::inv(&G::elem(2));
}

fn criterion_benchmark(c: &mut Criterion) {
  c.bench_function("group_rsa_op", |b| b.iter(bench_op::<Rsa2048>));
  c.bench_function("group_rsa_op_large", |b| b.iter(bench_op_large::<Rsa2048>));
  c.bench_function("group_rsa_exp", |b| b.iter(bench_exp::<Rsa2048>));
  c.bench_function("group_rsa_inv", |b| b.iter(bench_inv::<Rsa2048>));
}

criterion_group!(benches, criterion_benchmark);
criterion_main!(benches);
